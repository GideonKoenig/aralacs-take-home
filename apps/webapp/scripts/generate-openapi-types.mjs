import fs from "fs/promises";
import path from "path";
import openapiTS, { astToString } from "openapi-typescript";

const root = process.cwd();
const input = path.resolve(root, "../backend/openapi.json");
const output = path.resolve(
    root,
    "src/server/backend-integration/openapi-types.ts",
);

const banner = `/**\n * This file was auto-generated by openapi-typescript.\n * Do not make direct changes to the file.\n */\n\n`;

const schema = JSON.parse(await fs.readFile(input, "utf8"));
const result = await openapiTS(schema);
const types = Array.isArray(result) ? astToString(result) : result;
await fs.writeFile(output, banner + types, "utf8");
